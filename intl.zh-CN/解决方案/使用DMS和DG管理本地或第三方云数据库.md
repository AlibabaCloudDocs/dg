# 使用DMS和DG管理本地或第三方云数据库

阿里云数据库网关DG（Database Gateway）支持在不暴露公网IP的前提下，将本地自建或第三方云厂商的数据库与阿里云服务连接起来，避免使用公网IP连接的安全风险。您可以通过数据库网关将本地或第三方云数据库录入DMS进行管理。

将本地或第三方云的数据库接入阿里云时，有以下几种解决方案，但是均存在一定的局限性：

-   通过专线、VPN网关或智能网关接入：成本较高，不适用于个人用户。
-   将数据库的服务端口暴露至公网：存在被攻击的安全风险。
-   自建代理转发服务请求：稳定性较差，技术成本较高。

针对以上问题，数据管理DMS提供了通过数据库网关录入本地机房或第三方云数据库的功能，无需开放数据库的公网地址即可完成连接，并对数据传输进行安全加密。了解更多数据库网关的信息，请参见[数据库网关简介](~~124253~~)。

1.  登录[数据库网关控制台](https://account.aliyun.com/login/login.htm?oauth_callback=https%3A%2F%2Fdg.console.aliyun.com%2Fgateway&lang=en)，单击左上角选择数据库所处的地域（默认杭州），然后单击**新建网关**按钮。

2.  在弹出的对话框中，填写网关的名称和备注信息，然后单击**下一步**。

    ![新建网关](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/5236778061/p204009.png)

3.  安装网关。您可以根据操作系统类型，选择不同的安装包。Windows系统直接单击**下载安装包**，其他操作系统直接复制命令行到需要安装网关的机器上，回车执行即可。本地网关如果启动成功，会自动跳转到添加数据库页面，您也可以手动单击**下一步**按钮。

    **说明：** 数据库网关目前免费使用，您需要确保网关程序所在的机器符合以下要求：

    -   可以连通待接入的数据库，处于同一内网时可获得更低的网络延迟。
    -   可以访问公网（无需公网ip，无需暴露端口至公网，无需被公网访问，只要能主动访问公网即可）。
    ![安装网关](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/5236778061/p204012.png)

4.  添加数据库。您可以单击**添加数据库地址**直接向网关添加数据库，或者稍后添加。有关添加数据库的详细信息，请参见[添加数据库](/intl.zh-CN/用户指南/添加数据库.md)。

    ![添加数据库](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/5236778061/p204014.png)

5.  登录[DMS](https://dms.aliyun.com/)，在页面左上角单击**新增实例**

    ![新增实例](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/5236778061/p204016.png)

6.  在**新增实例**弹框中，选择**本地/他云数据库**，并选择具体的数据库类型。

    ![本地/他云数据库](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/6236778061/p204017.png)

7.  在**新增实例**对话框中按照下表的说明填写实例信息。

    ![实例信息](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/6236778061/p204018.png)

    |页签名称|参数名称|说明|
    |----|----|--|
    |基本信息|数据库来源|选择数据库实例的来源。此处选择本地/他云数据库。|
    |数据库类型|选择数据库实例的类型。|
    |实例地区|选择数据库网关所在的地域。|
    |网关id|选择数据库网关，如您还未创建数据库网关，可以单击**点此添加数据库网关**创建。|
    |登录地址|输入目标数据库的内网地址。|
    |端口|输入目标数据库的服务端口。|
    |数据库账号|输入数据库的登录账号。|
    |数据库密码|输入数据库账号对应的密码。|
    |管控模式|选择数据库的管控模式，详情请参见[管控模式功能细分](https://help.aliyun.com/document_detail/151629.html)|
    |高级信息|环境类型|选择数据库环境的类型。|
    |实例名称|自定义实例的名称。|
    |开启跨库查询|选择是否开启跨库查询功能，详情请参见[跨库查询](https://help.aliyun.com/document_detail/127641.html)|
    |不锁表结构变更|选择是否开启不锁表结构变更功能，详情请参见[不锁表结构变更](https://help.aliyun.com/document_detail/98373.html)|
    |实例DBA|选择一个DBA角色进行后期权限申请等流程。|
    |查询超时时间（s）|设定安全策略，当达到设定的时间后，SQL窗口执行的查询语句会中断，以保护数据库安全。|
    |导出超时时间（s）|设定安全策略，当达到设定的时间后，SQL窗口执行的导出语句会中断，以保护数据库安全。|

8.  单击左下角的**测试连接**，等待测试通过。

    **说明：** 如果测试失败，请检查您录入的实例信息。

9.  单击**提交**，至此本地或第三方云数据库已经成功录入到数据管理DMS，您可以在DMS左侧的实例列表中查看并管理您的数据库。


